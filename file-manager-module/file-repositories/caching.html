<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caching file resources - Across</title>
    <meta name="generator" content="Antora 2.1.1">
    <link rel="stylesheet" href="../../_/css/site.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<meta name="og:title" content="Across Documentation"/>
<meta name="og:image" content="https://across.foreach.be/across/resources/static/acrossWebsite/img/og-image-across.jpg"/>
<link rel="icon" type="image/png" sizes="16x16" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-16x16.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="96x96" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-96x96.png"/>
<link rel="apple-touch-icon" type="image/png" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-120x120.png"/>
<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-152x152.png"/>
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-180x180.png"/>
  </head>
  <body class="article">
<header class="header" role="banner">
  <div class="m-mobile-menu__button js-overlay-menu-button" data-target="mobile-menu">
    <span class="m-mobile-menu__line"></span>
    <span class="m-mobile-menu__line"></span>
    <span class="m-mobile-menu__line"></span>
  </div>

  <div class="m-mobile-menu">
    <div class="m-mobile-menu__logo">
      <a class="m-nav__logo" href="/">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.9 95.7">
          <title>logo-across</title>
          <path fill="#3CA873" d="M0 23.9l15.9-9.2 41.5 23.9-16 9.2"></path>
          <path fill="#0093D8" d="M25.5 9.2L41.4 0l41.5 23.9-16 9.2"></path>
          <path fill="#53DD99" d="M41.4 95.7l16-9.3V38.6l-16 9.2"></path>
          <path fill="#22CEFA" d="M66.9 80.9l16-9.2V23.9l-16 9.2"></path>
          <path fill="#257A50" d="M12.5 64.5L28.9 55l-16.4-9.4"></path>
          <path fill="#4DBC86" d="M12.5 64.5L28.9 74V55"></path>
        </svg>
        <span>Across</span>
      </a>
    </div>
  </div>
  <div class="m-mobile-menu__container js-mobile-menu-overlay" id="mobile-menu">
    <nav class="m-mobile-menu__list">
      <a href="https://across.foreach.be/blog">Blog</a>
      <a href="https://across.foreach.be/documentation" class="is-active">Docs</a>
      <a href="https://across.foreach.be/modules">Modules</a>
      <a href="https://across.foreach.be/faq">FAQ</a>
      <a href="http://start-across.foreach.be">Get started</a>
    </nav>
  </div>
  <nav class="m-nav is-sticky">
    <a class="m-nav__logo" href="../..">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.9 95.7">
        <title>logo-across</title>
        <path fill="#3CA873" d="M0 23.9l15.9-9.2 41.5 23.9-16 9.2"></path>
        <path fill="#0093D8" d="M25.5 9.2L41.4 0l41.5 23.9-16 9.2"></path>
        <path fill="#53DD99" d="M41.4 95.7l16-9.3V38.6l-16 9.2"></path>
        <path fill="#22CEFA" d="M66.9 80.9l16-9.2V23.9l-16 9.2"></path>
        <path fill="#257A50" d="M12.5 64.5L28.9 55l-16.4-9.4"></path>
        <path fill="#4DBC86" d="M12.5 64.5L28.9 74V55"></path>
      </svg>
      <span>Across</span>
    </a>

    <div class="m-nav__link-group">
      <a href="https://across.foreach.be/blog">Blog</a>
      <a href="https://across.foreach.be/documentation" class="is-active">Docs</a>
      <a href="https://across.foreach.be/modules">Modules</a>
      <a href="https://across.foreach.be/faq">FAQ</a>
      <a href="http://start-across.foreach.be">Get started</a>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="file-manager-module" data-version="master">
  <aside class="navigation">
    <div class="panels">
      <div id="search-box" class="search-box is-active">
        <input id="search-input" type="text" placeholder="Search the documentation">
      </div>
      <div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Module: File Management</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../quick-start.html">Quick start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../releases/index.html">Releases</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../releases/2.x.html">2.x</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../releases/1.x.html">1.x</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../configuration-properties.html">Configuration properties</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../integration.html">Integration with other modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../core-concepts/index.html">Virtual File System</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-concepts/file-descriptor.html">File descriptor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-concepts/folder-descriptor.html">Folder descriptor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-concepts/file-manager.html">File manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-concepts/file-repository.html">File repository</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-concepts/file-resource.html">File resource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-concepts/folder-resource.html">Folder resource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-concepts/file-reference.html">File reference</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="index.html">Supported file systems</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="local.html">Local files</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s3.html">Amazon S3</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="azure-blob.html">Azure Blob Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ftp.html">FTP/FTPS</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="expiring.html">Temporary files</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="caching.html">File resource caching</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="custom.html">Creating a custom file repository</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../file-reference/index.html">Linking to files</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../file-reference/file-reference.html">Uploading files</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../file-reference/file-metadata.html">Add metadata to files</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../developer-tools.html">Developer tools</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      <div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Module: File Management</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Across Platform</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../across/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../across/2.1.5/index.html">2.1.5</a>
        </li>
        <li class="version">
          <a href="../../across/2.1.4/index.html">2.1.4</a>
        </li>
        <li class="version">
          <a href="../../across/2.1.3/index.html">2.1.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Application Guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../guides/5.1.0-SNAPSHOT/index.html">5.1.0-SNAPSHOT</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Auto-configuration Support</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../across-autoconfigure/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Migration guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../migration/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Admin Web</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../admin-web-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../admin-web-module/3.2.0/index.html">3.2.0</a>
        </li>
        <li class="version">
          <a href="../../admin-web-module/3.1.1/index.html">3.1.1</a>
        </li>
        <li class="version">
          <a href="../../admin-web-module/3.1.0/index.html">3.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Application Info</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../application-info-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../application-info-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Batch Processing</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spring-batch-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../spring-batch-module/1.0.2/index.html">1.0.2</a>
        </li>
        <li class="version">
          <a href="../../spring-batch-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Bootstrap UI</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../bootstrap-ui-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../bootstrap-ui-module/2.2.2/index.html">2.2.2</a>
        </li>
        <li class="version">
          <a href="../../bootstrap-ui-module/2.2.1/index.html">2.2.1</a>
        </li>
        <li class="version">
          <a href="../../bootstrap-ui-module/2.1.1/index.html">2.1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Caching - Ehcache</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ehcache-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../ehcache-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Debug Web</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../debug-web-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../debug-web-module/2.0.0/index.html">2.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Documents & Forms</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dynamic-forms-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../dynamic-forms-module/0.0.3/index.html">0.0.3</a>
        </li>
        <li class="version">
          <a href="../../dynamic-forms-module/0.0.2/index.html">0.0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Entity Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../entity-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../entity-module/3.4.0/index.html">3.4.0</a>
        </li>
        <li class="version">
          <a href="../../entity-module/3.3.0/index.html">3.3.0</a>
        </li>
        <li class="version">
          <a href="../../entity-module/3.2.0/index.html">3.2.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Module: File Management</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
        <li class="version">
          <a href="../2.1.0-SNAPSHOT/index.html">2.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../1.4.0/index.html">1.4.0</a>
        </li>
        <li class="version">
          <a href="../1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Hibernate JPA</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hibernate-jpa-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../hibernate-jpa-module/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: LDAP Support</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ldap-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../ldap-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Logging</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../logging-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../logging-module/1.1.0/index.html">1.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Mobile Support</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spring-mobile-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../spring-mobile-module/2.0.0/index.html">2.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Properties</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../properties-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../properties-module/1.1.1/index.html">1.1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spring-security-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../spring-security-module/4.1.0-SNAPSHOT/index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../spring-security-module/3.0.2/index.html">3.0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security - ACLs</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spring-security-acl-module/4.1.0-SNAPSHOT/index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../spring-security-acl-module/3.0.2/index.html">3.0.2</a>
        </li>
        <li class="version">
          <a href="../../spring-security-acl-module/3.0.1/index.html">3.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security - OAuth2</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../oauth2-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../oauth2-module/2.1.1/index.html">2.1.1</a>
        </li>
        <li class="version">
          <a href="../../oauth2-module/2.1.0/index.html">2.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: User Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../user-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../user-module/4.1.0-SNAPSHOT/index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../user-module/3.1.1/index.html">3.1.1</a>
        </li>
        <li class="version">
          <a href="../../user-module/3.1.0/index.html">3.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Web CMS</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../web-cms-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../web-cms-module/0.0.7/index.html">0.0.7</a>
        </li>
        <li class="version">
          <a href="../../web-cms-module/0.0.6/index.html">0.0.6</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
    <script>
      var indexName = window.location.href.indexOf('across-site/production/')>0 ? 'antora-across-site-production' : 'antora-across-site-preview';
      docsearch({
                  appId: 'YNK2RERBV5',
                  apiKey: '201d66bbf44a6c62002472e491d74568',
                  indexName: indexName,
                  inputSelector: '#search-input',
                  algoliaOptions: { hitsPerPage: 10 }
                })
    </script>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../across/index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">Module: File Management</a></li>
    <li class="crumb"><a href="caching.html">File resource caching</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="versions-menu-toggle" title="Show other versions of page">master</button>
  <div class="versions-menu">
    <a class="version is-current" href="caching.html">master</a>
    <a class="version" href="../2.1.0-SNAPSHOT/file-repositories/caching.html">2.1.0-SNAPSHOT</a>
    <a class="version" href="../1.4.0/file-repositories/caching.html">1.4.0</a>
    <a class="version is-missing" href="../1.3.0/index.html">1.3.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/ForeachOS/ax-docs-file-manager-module/edit/master/docs/modules/ROOT/pages/file-repositories/caching.adoc">Edit this Page</a></div>
</div>
<article class="doc"><a name="section-top"></a>
      <h1>Caching file resources</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Some repositories - for example remote <a href="s3.html" class="page">Amazon S3 storage</a> - can be slow to work with and when needing their files frequently it can be beneficial to cache a local version of the file.</p>
</div>
<div class="paragraph">
<p>The <code>CachingFileRepository</code> is a special version of <code><a href="expiring.html#ExpiringFileRepository" class="page">ExpiringFileRepository</a></code> that allows you to do just that: wrap around a <code>FileRepository</code> and transparently cache the data from its file resources in another repository.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_cachingfilerepository_works"><a class="anchor" href="#_how_cachingfilerepository_works"></a>How CachingFileRepository works</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>CachingFileRepository</code> wraps around a <em>target repository</em> which holds the original file resources.</p>
</div>
<div class="paragraph">
<p>Whenever a file resource is requested it will also request a file resource representing the cached version from the specified <em>cache repository</em>.</p>
</div>
<div class="paragraph">
<p>If the cached version does not exist, it will be created the first time the actual file data is accessed.</p>
</div>
<div class="paragraph">
<p>File data updates immediately update both cache and original file resource, consumers do not need to be aware of a caching repository.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cache_expiration"><a class="anchor" href="#_cache_expiration"></a>Cache expiration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>CachingFileRepository</code> is a form of <code><a href="expiring.html#ExpiringFileRepository" class="page">ExpiringFileRepository</a></code> where it is the cached version that expires.</p>
</div>
<div class="paragraph">
<p>The file resource in the target repository will never be modified if the cached version expires.</p>
</div>
<div class="paragraph">
<p>When working with caching repositories you should also activate the <a href="expiring.html#cleanup-interval" class="page">automatic expiration of tracked items</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filedescriptor_translation"><a class="anchor" href="#_filedescriptor_translation"></a>FileDescriptor translation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>CachingFileRepository</code> works with 2 file repositories internally:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the target repository which holds the original file resource</p>
</li>
<li>
<p>the cache repository which holds the cached version of the file resource</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As such a <code>FileResource</code> returned by the <code>CachingFileRepository</code> internally uses 2 file descriptors representing the same file resource:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one to the target repository representing the original file</p>
</li>
<li>
<p>one to the cache repository representing the cached version</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>CachingFileRepository</code> allows you to configure how to determine the file descriptor for the cached version of the file.
Depending on the cache repository there are 2 typical scenarios:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The file descriptor to the cached version is generated whenever the original is fetched.
This implies a separate file resource in the cache repository will be used between application restarts or once an item has been evicted.
Actual cached versions will never be reused.<br>
<br>
Pre-configure this approach with <code>CachingFileRepository.withGeneratedFileDescriptor()</code>.</p>
</li>
<li>
<p>The file descriptor to the cached version is translated from the original descriptor.
The same original descriptor will always return the same cached version descriptor.
Use this approach if you want to maximize reuse of the cached versions, even across application restarts.<br></p>
<div class="paragraph">
<p>Pre-configure this approach with <code>CachingFileRepository.withTranslatedFileDescriptor()</code>.
In this case the same folder id and filename from the original file descriptor will be used for the cached version.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If neither of the 2 default scenarios suite your purpose, you can configure a custom <code>cacheFileResourceResolver</code> to determine how the cached version <code>FileResource</code> should be resolved in the cache repository.</p>
</div>
<div class="sect2">
<h3 id="_example_configuration"><a class="anchor" href="#_example_configuration"></a>Example configuration</h3>
<div class="paragraph">
<p>The following example configures a caching repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
public FileRepository bigFileRepository( AmazonS3 amazonS3 ) {
    FileRepository originals = AmazonS3FileRepository.builder() <i class="conum" data-value="1"></i><b>(1)</b>
                                                     .repositoryId( "bigfiles" )
                                                     .amazonS3( amazonS3 )
                                                     .bucketName( "documents" )
                                                     .build();

    return CachingFileRepository.withTranslatedFileDescriptor() <i class="conum" data-value="2"></i><b>(2)</b>
                                .maxItemsToTrack( 50 ) <i class="conum" data-value="3"></i><b>(3)</b>
                                .timeBasedExpiration( 60 * 60000L, 24 * 60 * 60000L ) <i class="conum" data-value="4"></i><b>(4)</b>
                                .targetFileRepository( originals ) <i class="conum" data-value="5"></i><b>(5)</b>
                                .cacheRepositoryId( "cache" ) <i class="conum" data-value="6"></i><b>(6)</b>
                                .build();
}

@Bean
FileRepository cacheRepository() { <i class="conum" data-value="6"></i><b>(6)</b>
    return LocalFileRepository.builder()
                              .repositoryId( "cache" )
                              .rootFolder( "local-bigfiles-cache" )
                              .build();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we declare an Amazon S3 file repository where the original resources will be stored</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>CachingFileRepository</code> will generate a file descriptor for the cached version by translating the original file descriptor.
This also pre-configures the <code>expireOnEvict</code> and <code>expireOnShutdown</code> properties (in this case both will be <code>false</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>only 50 items will be tracked, after that the oldest item will be evicted</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>we configure a default time-based expiration strategy: items expire when they have not been accessed for 60 minutes or if they have existed for more than 24 hours</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>our <code>CachingFileRepository</code> wraps the <code>originals</code> repository, takes its identity and uses it for fetching the original file resources.
As such our repository id will also be <code>bigfiles</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the cached versions will be stored in the repository with id <code>cache</code>.
Instead of directly passing the <code>FileRepository</code> instance, we only need to specify the id of the repository.
The <code>FileManager</code> will be used to fetch the repository when it is required.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When setting up a <code>CachingFileRepository</code> you usually want to use a fast <code>FileRepository</code> implementation for the actual cache.
It is important that calls to <code>FileResource.exists()</code> are fast and cheap on the cached version, as they are done frequently to see if the actual cached data is present.</p>
</div>
<div class="paragraph">
<p>Usually a <code><a href="local.html" class="page">LocalFileRepository</a></code> is used for storing the cached versions.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
A <code>CachingFileRepository</code> always wraps another repository and takes its identity.
You should take care only to register the <code>CachingFileRepository</code> as otherwise there would be more than one repository with the same id.<br>
<br>
For this reason the <code>AmazonS3FileRepository</code> is not declared separately as a bean in the example above.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
    <div class="article-footer-nav">
        <a class="article-footer-nav-previous" href="expiring.html">&laquo; Temporary files</a>
            <span class="article-footer-nav-current">File resource caching</span>
        <a class="article-footer-nav-next" href="custom.html">Creating a custom file repository &raquo;</a>
    </div>
</article>
<aside class="article-aside hidden" role="navigation">
  <h3 class="toc-title">Contents</h3>
  <div id="article-toc"></div>
</aside>
  </main>
</div>
<footer class="footer">
  <p>The Across documentation site is generated using <a href="https://antora.org" target="_blank">Antora</a>.</p>
  <div class="footer-totop">
    <!--srcset="/acrossWebsite/img/foreach-logo@2x.png 2x"-->
    <a class="footer-partner" href="http://foreach.be/" target="_blank">
      sponsored by <svg width="20" height="20" viewBox="0 0 277 311" xmlns="http://www.w3.org/2000/svg">
        <g fill="none" fill-rule="evenodd">
          <path d="M27 307.3V133.5H.9V92.7H27v-8.8c0-24.1 4.3-46.5 19.7-64.1C58.2 6.6 74.7.1 92.9.1c13.4 0 23.7 2.2 31.2 4.8l-5.9 44.8c-3.9-1.8-9.5-2.6-15.8-2.6-17.4 0-23.7 16.7-23.7 35.5v10.1h33.6v40.8H78.7v173.8H27z" fill="#FFCE01" fill-rule="nonzero"></path>
          <path d="M229.2 181c0-27.6-6.3-49.1-21.7-49.1-17 0-23.7 27.7-24.1 49.1h45.8zM183 221.4c.8 33.4 18.2 45.6 41.1 45.6 14.6 0 27.6-3.5 36.7-7l7.1 41.2c-13.4 5.7-33.6 9.7-53.3 9.7-52.5 0-81.4-38.6-81.4-105.8 0-72 33.6-115 77.4-115 41.5 0 65.6 36.4 65.6 101.4 0 15.4-.4 23.7-1.6 29.8H183v.1z" fill="#FFF" fill-rule="nonzero"></path>
        </g>
      </svg>
    </a>
    <a href="#section-top">
      <svg width="34" height="34" viewBox="0 0 62 62" xmlns="http://www.w3.org/2000/svg">
        <title>icon</title>
        <g transform="rotate(-90 30.5 30.5)" fill="none" fill-rule="evenodd">
          <circle stroke="#ffffff" fill="#1D2A3A" transform="rotate(180 30.007 30.942)" cx="30.007" cy="30.942" r="30"></circle>
          <path fill="#ffffff" d="M25 38.884h3.713l6.3-7.797-6.3-8.087-3.713.064 6.155 7.972"></path>
        </g>
      </svg>
    </a>
  </div>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script>
  tocbot.init( {
                 tocSelector: '#article-toc',
                 contentSelector: 'article',
                 headingSelector: 'h2, h3, h4',
                 collapseDepth: 3,
                 positionFixedSelector: '#article-toc',
                 scrollSmooth: false
               } );
  var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
  if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
    document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
  }
</script>
  </body>
</html>
