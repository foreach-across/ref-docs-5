<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working with events - Across</title>
    <meta name="generator" content="Antora 2.1.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<meta name="og:title" content="Across Documentation"/>
<meta name="og:image" content="https://across.foreach.be/across/resources/static/acrossWebsite/img/og-image-across.jpg"/>
<link rel="icon" type="image/png" sizes="16x16" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-16x16.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="96x96" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-96x96.png"/>
<link rel="apple-touch-icon" type="image/png" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-120x120.png"/>
<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-152x152.png"/>
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-180x180.png"/>
  </head>
  <body class="article">
<header class="header" role="banner">
  <div class="m-mobile-menu__button js-overlay-menu-button" data-target="mobile-menu">
    <span class="m-mobile-menu__line"></span>
    <span class="m-mobile-menu__line"></span>
    <span class="m-mobile-menu__line"></span>
  </div>

  <div class="m-mobile-menu">
    <div class="m-mobile-menu__logo">
      <a class="m-nav__logo" href="/">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.9 95.7">
          <title>logo-across</title>
          <path fill="#3CA873" d="M0 23.9l15.9-9.2 41.5 23.9-16 9.2"></path>
          <path fill="#0093D8" d="M25.5 9.2L41.4 0l41.5 23.9-16 9.2"></path>
          <path fill="#53DD99" d="M41.4 95.7l16-9.3V38.6l-16 9.2"></path>
          <path fill="#22CEFA" d="M66.9 80.9l16-9.2V23.9l-16 9.2"></path>
          <path fill="#257A50" d="M12.5 64.5L28.9 55l-16.4-9.4"></path>
          <path fill="#4DBC86" d="M12.5 64.5L28.9 74V55"></path>
        </svg>
        <span>Across</span>
      </a>
    </div>
  </div>
  <div class="m-mobile-menu__container js-mobile-menu-overlay" id="mobile-menu">
    <nav class="m-mobile-menu__list">
      <a href="https://across.foreach.be/blog">Blog</a>
      <a href="https://across.foreach.be/documentation" class="is-active">Docs</a>
      <a href="https://across.foreach.be/modules">Modules</a>
      <a href="https://across.foreach.be/faq">FAQ</a>
      <a href="http://start-across.foreach.be">Get started</a>
    </nav>
  </div>
  <nav class="m-nav is-sticky">
    <a class="m-nav__logo" href="../../..">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.9 95.7">
        <title>logo-across</title>
        <path fill="#3CA873" d="M0 23.9l15.9-9.2 41.5 23.9-16 9.2"></path>
        <path fill="#0093D8" d="M25.5 9.2L41.4 0l41.5 23.9-16 9.2"></path>
        <path fill="#53DD99" d="M41.4 95.7l16-9.3V38.6l-16 9.2"></path>
        <path fill="#22CEFA" d="M66.9 80.9l16-9.2V23.9l-16 9.2"></path>
        <path fill="#257A50" d="M12.5 64.5L28.9 55l-16.4-9.4"></path>
        <path fill="#4DBC86" d="M12.5 64.5L28.9 74V55"></path>
      </svg>
      <span>Across</span>
    </a>

    <div class="m-nav__link-group">
      <a href="https://across.foreach.be/blog">Blog</a>
      <a href="https://across.foreach.be/documentation" class="is-active">Docs</a>
      <a href="https://across.foreach.be/modules">Modules</a>
      <a href="https://across.foreach.be/faq">FAQ</a>
      <a href="http://start-across.foreach.be">Get started</a>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="guides" data-version="5.1.0-SNAPSHOT">
  <aside class="navigation">
    <div class="panels">
      <div id="search-box" class="search-box is-active">
        <input id="search-input" type="text" placeholder="Search the documentation">
      </div>
      <div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Application Guides</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="index.html">Building a modular monolith</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-creating-a-module.html">Applications and modules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2-module-dependencies.html">Module dependencies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3-using-module-components.html">Using module components</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="4-working-with-events.html">Working with events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5-dynamic-application-module.html">Dynamic application module</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../security/oauth2-sso.html">Adding security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security/oauth2-sso.html">OAuth2 with Single-Sign On</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      <div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Application Guides</span>
    <span class="version">5.1.0-SNAPSHOT</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Across Platform</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../across/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../across/2.1.5/index.html">2.1.5</a>
        </li>
        <li class="version">
          <a href="../../../across/2.1.4/index.html">2.1.4</a>
        </li>
        <li class="version">
          <a href="../../../across/2.1.3/index.html">2.1.3</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Application Guides</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">5.1.0-SNAPSHOT</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Auto-configuration Support</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../across-autoconfigure/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Migration guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../migration/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Admin Web</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../admin-web-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../admin-web-module/3.2.0/index.html">3.2.0</a>
        </li>
        <li class="version">
          <a href="../../../admin-web-module/3.1.1/index.html">3.1.1</a>
        </li>
        <li class="version">
          <a href="../../../admin-web-module/3.1.0/index.html">3.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Application Info</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../application-info-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../application-info-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Batch Processing</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../spring-batch-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../spring-batch-module/1.0.2/index.html">1.0.2</a>
        </li>
        <li class="version">
          <a href="../../../spring-batch-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Bootstrap UI</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../bootstrap-ui-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../bootstrap-ui-module/2.2.2/index.html">2.2.2</a>
        </li>
        <li class="version">
          <a href="../../../bootstrap-ui-module/2.2.1/index.html">2.2.1</a>
        </li>
        <li class="version">
          <a href="../../../bootstrap-ui-module/2.1.1/index.html">2.1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Caching - Ehcache</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ehcache-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../ehcache-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Debug Web</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../debug-web-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../debug-web-module/2.0.0/index.html">2.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Documents & Forms</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../dynamic-forms-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../dynamic-forms-module/0.0.3/index.html">0.0.3</a>
        </li>
        <li class="version">
          <a href="../../../dynamic-forms-module/0.0.2/index.html">0.0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Entity Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../entity-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../entity-module/3.4.0/index.html">3.4.0</a>
        </li>
        <li class="version">
          <a href="../../../entity-module/3.3.0/index.html">3.3.0</a>
        </li>
        <li class="version">
          <a href="../../../entity-module/3.2.0/index.html">3.2.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: File Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../file-manager-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../file-manager-module/2.1.0-SNAPSHOT/index.html">2.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../../file-manager-module/1.4.0/index.html">1.4.0</a>
        </li>
        <li class="version">
          <a href="../../../file-manager-module/1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Hibernate JPA</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../hibernate-jpa-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../hibernate-jpa-module/3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: LDAP Support</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ldap-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../ldap-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Logging</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../logging-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../logging-module/1.1.0/index.html">1.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Mobile Support</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../spring-mobile-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../spring-mobile-module/2.0.0/index.html">2.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Properties</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../properties-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../properties-module/1.1.1/index.html">1.1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../spring-security-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../spring-security-module/4.1.0-SNAPSHOT/index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../../spring-security-module/3.0.2/index.html">3.0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security - ACLs</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../spring-security-acl-module/4.1.0-SNAPSHOT/index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../../spring-security-acl-module/3.0.2/index.html">3.0.2</a>
        </li>
        <li class="version">
          <a href="../../../spring-security-acl-module/3.0.1/index.html">3.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security - OAuth2</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../oauth2-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../oauth2-module/2.1.1/index.html">2.1.1</a>
        </li>
        <li class="version">
          <a href="../../../oauth2-module/2.1.0/index.html">2.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: User Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../user-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../user-module/4.1.0-SNAPSHOT/index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../../user-module/3.1.1/index.html">3.1.1</a>
        </li>
        <li class="version">
          <a href="../../../user-module/3.1.0/index.html">3.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Web CMS</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../web-cms-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../../web-cms-module/0.0.7/index.html">0.0.7</a>
        </li>
        <li class="version">
          <a href="../../../web-cms-module/0.0.6/index.html">0.0.6</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
    <script>
      var indexName = window.location.href.indexOf('across-site/production/')>0 ? 'antora-across-site-production' : 'antora-across-site-preview';
      docsearch({
                  appId: 'YNK2RERBV5',
                  apiKey: '201d66bbf44a6c62002472e491d74568',
                  indexName: indexName,
                  inputSelector: '#search-input',
                  algoliaOptions: { hitsPerPage: 10 }
                })
    </script>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../../across/index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">Application Guides</a></li>
    <li class="crumb"><a href="index.html">Building a modular monolith</a></li>
    <li class="crumb"><a href="4-working-with-events.html">Working with events</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/ForeachOS/ax-docs-platform/edit/master/docs/guides/modules/ROOT/pages/modular-monoliths/4-working-with-events.adoc">Edit this Page</a></div>
</div>
<article class="doc"><a name="section-top"></a>
      <h1>Working with events</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>This section covers event handling in an Across application, it explains:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><i class="fa fa-check-square-o"></i> How to publish and handle events</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> How event handling order is determined by the module dependencies</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> The difference between implicit and explicit ordering</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This how-to is part of the <a href="index.html" class="page">Building a modular monolith</a> series.
It continues directly from the previous how-to on <a href="3-using-module-components.html" class="page">Using module components</a>.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publishing_and_handling_events"><a class="anchor" href="#_publishing_and_handling_events"></a>Publishing and handling events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Just like with distributed systems, using events for inter-module communication can be a very effective way to reduce coupling in your application.
Working with events in an Across application is done with the exact same features as in a regular Spring application, but module ordering influences how events are handled.
Let&#8217;s have a look.</p>
</div>
<div class="paragraph">
<p>Create a sample <code>SomeEvent</code> class which we will publish.
In this case, put it in the <code>com.example.demo.modules</code> package to illustrate it is part of the code shared between all modules.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/example/demo/modules/SomeEvent.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example.demo.modules;

import java.util.ArrayList;

public class SomeEvent extends ArrayList&lt;String&gt;
{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our event is nothing more than an <code>ArrayList</code> implementation to which every listener will add its own name.</p>
</div>
<div class="paragraph">
<p>Update the <code>SupplierService</code> with a new method which publishes the event and returns the names of all listeners that handled it.
At the same time, add an <code>@EventListener</code> method in the <code>SupplierService</code> which listens for the same event.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/example/demo/modules/three/SupplierService.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Service
@RequiredArgsConstructor
public class SupplierService
{
	private final ApplicationEventPublisher eventPublisher;

	...

	public Collection&lt;String&gt; getEventListeners() {
		SomeEvent event = new SomeEvent();
		eventPublisher.publishEvent( event );
		return event;
	}

	@EventListener
	public void receive( SomeEvent event ) {
		event.add( getClass().getSimpleName() );
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also add some event listeners to the internal components of both <code>ModuleOne</code> and <code>ModuleTwo</code></p>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/example/demo/moduls/one/InternalComponentOne.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
@Slf4j
public class InternalComponentOne
{
	...

	@EventListener
	public void receive( SomeEvent event ) {
		event.add( getClass().getSimpleName() );
	}
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/example/demo/moduls/two/InternalComponentTwo.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Component
@Slf4j
public class InternalComponentTwo
{
	...

	@EventListener
	public void receive( SomeEvent event ) {
		event.add( getClass().getSimpleName() );
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally write an integration test that bootstraps our modules and verifies the list of event listeners.</p>
</div>
<div class="listingblock">
<div class="title">src/test/java/test/TestModuleBootstrapScenarios.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void eventIsHandledInModuleOrder() {
    try (AcrossTestContext ctx = AcrossTestBuilders.standard( false )
                                                   .modules( new ModuleThree(), new ModuleOne(), new ModuleTwo() )
                                                   .build()) {
        SupplierService supplierService = ctx.getBeanOfType( SupplierService.class );
        assertEquals( Arrays.asList( "SupplierService", "InternalComponentOne", "InternalComponentTwo" ), supplierService.getEventListeners() );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>No matter how often you run it, this test should always succeed.
Without explicit ordering on the <code>@EventListener</code> methods, the bootstrap order ensures that events are always handled in the same order.</p>
</div>
<div class="paragraph">
<p>Here is a run-down of what happens exactly:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the modules are bootstrapped in the order <code>ModuleThree</code>, <code>ModuleOne</code>, <code>ModuleTwo</code></p>
</li>
<li>
<p><code>SomeEvent</code> is published by the <code>SupplierService</code> inside <code>ModuleThree</code></p>
</li>
<li>
<p><code>SomeEvent</code> is handled by <code>SupplierService.receive()</code></p>
</li>
<li>
<p><code>SomeEvent</code> is handled by <code>InternalComponentOne.receive()</code></p>
</li>
<li>
<p><code>SomeEvent</code> is handled by <code>InternalComponentTwo.receive()</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Even though <code>SupplierService</code> publishes the event, it will always be handled in module order.
This is might seem obvious with the above example, but let&#8217;s shift the order around in our test:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>.modules( new ModuleTwo(), new ModuleThree(), new ModuleOne() )</pre>
</div>
</div>
<div class="paragraph">
<p>If we simply re-run the test it now fails, as the order of handlers has changed.
Let&#8217;s go over it step-by-step:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the modules are now bootstrapped in the order <code>ModuleOne</code>, <code>ModuleTwo</code>, <code>ModuleThree</code></p>
</li>
<li>
<p><code>SomeEvent</code> is published by the <code>SupplierService</code> inside <code>ModuleThree</code></p>
</li>
<li>
<p><code>SomeEvent</code> is handled by <code>InternalComponentOne.receive()</code></p>
</li>
<li>
<p><code>SomeEvent</code> is handled by <code>InternalComponentTwo.receive()</code></p>
</li>
<li>
<p><code>SomeEvent</code> is handled by <code>SupplierService.receive()</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Because <code>ModuleTwo</code> has a dependency on <code>ModuleOne</code>, the relative ordering of those two modules will always be the same.
<code>ModuleThree</code> has no dependencies, and because the registration order of our configuration has changed, it is now bootstrapped as the last module.
Even though the event is published by that module, it is last when it comes to handling that same event!</p>
</div>
<div class="paragraph">
<p>Properly using events is a great way for building extensibility.
The same event will always be handled by any module you depend on, before it is handed to you.
Note also that any component can handle an event, event listeners do not need to be exposed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implicit_and_explicit_ordering"><a class="anchor" href="#_implicit_and_explicit_ordering"></a>Implicit and explicit ordering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ve illustrated the impact of ordering on components and event handling.</p>
</div>
<div class="paragraph">
<p>In a regular Spring application most components are considered not-ordered unless they are explicitly ordered.
Beans will be returned in order if they implement <code>Ordered</code> or have the <code>@Order</code> annotation.
If they have neither of these, the order in which they will be returned cannot reliably be determined.
The same goes for <code>@EventListener</code> methods, unless explicitly ordered using <code>@Order</code>, the handling order is non-deterministic.</p>
</div>
<div class="paragraph">
<p>In an Across based modular application, the order of a lot of things is implicit.
Because module A depends on module B, it will be ordered after it, which means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>components from B will be created before the ones from A (B will bootstrap before A)</p>
</li>
<li>
<p><em>unless otherwise specified</em>: components from B will be ordered before the ones from A in retrieval/auto-wiring scenarios</p>
</li>
<li>
<p><em>unless otherwise specified</em>: events will be handled by event listeners from B before the ones from A, no matter who publishes the event</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course sometimes it is required to break out of the default behaviour, which is still possible (<em>unless otherwise specified</em>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>using <code>@OrderInModule</code> and equivalents you can order components inside a single module</p>
</li>
<li>
<p>using <code>@Order</code> you can influence the global ordering in your application</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate this, let&#8217;s revisit the failing test from above, and update the <code>SupplierService</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/com/example/demo/modules/three/SupplierService.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Service
@RequiredArgsConstructor
public class SupplierService
{
    ...

	@EventListener
	@Order(Ordered.HIGHEST_PRECEDENCE)
	public void receive( SomeEvent event ) {
		event.add( getClass().getSimpleName() );
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Re-run and you will see the test is green again.
The <code>@Order(HIGHEST_PRECEDENCE)</code> breaks out of the default ordering and pushes that event listener to the very top of the handling queue.</p>
</div>
<div class="paragraph">
<p>Going into the details of how the ordering works behind the scene would lead us too far, but suffice to say that reliable default ordering is a cornerstone of building modular monoliths with Spring Boot and Across.</p>
</div>
<div class="paragraph">
<p>To continue this series, let&#8217;s have a look at the <a href="5-dynamic-application-module.html" class="page">Dynamic application module</a>.</p>
</div>
</div>
</div>
    <div class="article-footer-nav">
        <a class="article-footer-nav-previous" href="3-using-module-components.html">&laquo; Using module components</a>
            <span class="article-footer-nav-current">Working with events</span>
        <a class="article-footer-nav-next" href="5-dynamic-application-module.html">Dynamic application module &raquo;</a>
    </div>
</article>
<aside class="article-aside hidden" role="navigation">
  <h3 class="toc-title">Contents</h3>
  <div id="article-toc"></div>
</aside>
  </main>
</div>
<footer class="footer">
  <p>The Across documentation site is generated using <a href="https://antora.org" target="_blank">Antora</a>.</p>
  <div class="footer-totop">
    <!--srcset="/acrossWebsite/img/foreach-logo@2x.png 2x"-->
    <a class="footer-partner" href="http://foreach.be/" target="_blank">
      sponsored by <svg width="20" height="20" viewBox="0 0 277 311" xmlns="http://www.w3.org/2000/svg">
        <g fill="none" fill-rule="evenodd">
          <path d="M27 307.3V133.5H.9V92.7H27v-8.8c0-24.1 4.3-46.5 19.7-64.1C58.2 6.6 74.7.1 92.9.1c13.4 0 23.7 2.2 31.2 4.8l-5.9 44.8c-3.9-1.8-9.5-2.6-15.8-2.6-17.4 0-23.7 16.7-23.7 35.5v10.1h33.6v40.8H78.7v173.8H27z" fill="#FFCE01" fill-rule="nonzero"></path>
          <path d="M229.2 181c0-27.6-6.3-49.1-21.7-49.1-17 0-23.7 27.7-24.1 49.1h45.8zM183 221.4c.8 33.4 18.2 45.6 41.1 45.6 14.6 0 27.6-3.5 36.7-7l7.1 41.2c-13.4 5.7-33.6 9.7-53.3 9.7-52.5 0-81.4-38.6-81.4-105.8 0-72 33.6-115 77.4-115 41.5 0 65.6 36.4 65.6 101.4 0 15.4-.4 23.7-1.6 29.8H183v.1z" fill="#FFF" fill-rule="nonzero"></path>
        </g>
      </svg>
    </a>
    <a href="#section-top">
      <svg width="34" height="34" viewBox="0 0 62 62" xmlns="http://www.w3.org/2000/svg">
        <title>icon</title>
        <g transform="rotate(-90 30.5 30.5)" fill="none" fill-rule="evenodd">
          <circle stroke="#ffffff" fill="#1D2A3A" transform="rotate(180 30.007 30.942)" cx="30.007" cy="30.942" r="30"></circle>
          <path fill="#ffffff" d="M25 38.884h3.713l6.3-7.797-6.3-8.087-3.713.064 6.155 7.972"></path>
        </g>
      </svg>
    </a>
  </div>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script>
  tocbot.init( {
                 tocSelector: '#article-toc',
                 contentSelector: 'article',
                 headingSelector: 'h2, h3, h4',
                 collapseDepth: 3,
                 positionFixedSelector: '#article-toc',
                 scrollSmooth: false
               } );
  var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
  if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
    document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
  }
</script>
  </body>
</html>
