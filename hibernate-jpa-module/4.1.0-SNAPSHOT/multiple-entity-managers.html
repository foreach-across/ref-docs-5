<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiple EntityManagers - Across</title>
    <meta name="generator" content="Antora 2.1.1">
    <link rel="stylesheet" href="../../_/css/site.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<meta name="og:title" content="Across Documentation"/>
<meta name="og:image" content="https://across.foreach.be/across/resources/static/acrossWebsite/img/og-image-across.jpg"/>
<link rel="icon" type="image/png" sizes="16x16" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-16x16.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-32x32.png"/>
<link rel="icon" type="image/png" sizes="96x96" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/favicon-96x96.png"/>
<link rel="apple-touch-icon" type="image/png" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-120x120.png"/>
<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-152x152.png"/>
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://across.foreach.be/across/resources/static/acrossWebsite/img/favicon/apple-icon-180x180.png"/>
  </head>
  <body class="article">
<header class="header" role="banner">
  <div class="m-mobile-menu__button js-overlay-menu-button" data-target="mobile-menu">
    <span class="m-mobile-menu__line"></span>
    <span class="m-mobile-menu__line"></span>
    <span class="m-mobile-menu__line"></span>
  </div>

  <div class="m-mobile-menu">
    <div class="m-mobile-menu__logo">
      <a class="m-nav__logo" href="/">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.9 95.7">
          <title>logo-across</title>
          <path fill="#3CA873" d="M0 23.9l15.9-9.2 41.5 23.9-16 9.2"></path>
          <path fill="#0093D8" d="M25.5 9.2L41.4 0l41.5 23.9-16 9.2"></path>
          <path fill="#53DD99" d="M41.4 95.7l16-9.3V38.6l-16 9.2"></path>
          <path fill="#22CEFA" d="M66.9 80.9l16-9.2V23.9l-16 9.2"></path>
          <path fill="#257A50" d="M12.5 64.5L28.9 55l-16.4-9.4"></path>
          <path fill="#4DBC86" d="M12.5 64.5L28.9 74V55"></path>
        </svg>
        <span>Across</span>
      </a>
    </div>
  </div>
  <div class="m-mobile-menu__container js-mobile-menu-overlay" id="mobile-menu">
    <nav class="m-mobile-menu__list">
      <a href="https://across.foreach.be/blog">Blog</a>
      <a href="https://across.foreach.be/documentation" class="is-active">Docs</a>
      <a href="https://across.foreach.be/modules">Modules</a>
      <a href="https://across.foreach.be/faq">FAQ</a>
      <a href="http://start-across.foreach.be">Get started</a>
    </nav>
  </div>
  <nav class="m-nav is-sticky">
    <a class="m-nav__logo" href="../..">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 82.9 95.7">
        <title>logo-across</title>
        <path fill="#3CA873" d="M0 23.9l15.9-9.2 41.5 23.9-16 9.2"></path>
        <path fill="#0093D8" d="M25.5 9.2L41.4 0l41.5 23.9-16 9.2"></path>
        <path fill="#53DD99" d="M41.4 95.7l16-9.3V38.6l-16 9.2"></path>
        <path fill="#22CEFA" d="M66.9 80.9l16-9.2V23.9l-16 9.2"></path>
        <path fill="#257A50" d="M12.5 64.5L28.9 55l-16.4-9.4"></path>
        <path fill="#4DBC86" d="M12.5 64.5L28.9 74V55"></path>
      </svg>
      <span>Across</span>
    </a>

    <div class="m-nav__link-group">
      <a href="https://across.foreach.be/blog">Blog</a>
      <a href="https://across.foreach.be/documentation" class="is-active">Docs</a>
      <a href="https://across.foreach.be/modules">Modules</a>
      <a href="https://across.foreach.be/faq">FAQ</a>
      <a href="http://start-across.foreach.be">Get started</a>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="hibernate-jpa-module" data-version="4.1.0-SNAPSHOT">
  <aside class="navigation">
    <div class="panels">
      <div id="search-box" class="search-box is-active">
        <input id="search-input" type="text" placeholder="Search the documentation">
      </div>
      <div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Module: Hibernate JPA</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Quick start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="releases/index.html">Releases</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="releases/4.x.html">4.x</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="releases/3.x.html">3.x</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="releases/2.x.html">2.x</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="releases/1.x.html">1.x</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="configuration-properties.html">Configuration properties</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="using/index.html">Using Hibernate JPA</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="using/datasource.html">Specifying the datasource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="using/registering-entities.html">Registering entities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="using/jpa-properties.html">Configure JPA properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="using/spring-data.html">Spring Data JPA repositories</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="using/transaction-session.html">Transactions &amp; sessions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="entity-intercepting.html">Entity intercepting</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="multiple-entity-managers.html">Multiple entity managers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="helpers.html">Helper classes and utilities</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="helpers.html#sequence-generator">Sequence generator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="helpers.html#entity-base-classes">Entity base classes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="helpers.html#auditable-entities">Auditable entities</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
      <div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Module: Hibernate JPA</span>
    <span class="version">4.1.0-SNAPSHOT</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Across Platform</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../across/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../across/5.1.0-SNAPSHOT/index.html">5.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../across/2.1.5/index.html">2.1.5</a>
        </li>
        <li class="version">
          <a href="../../across/2.1.4/index.html">2.1.4</a>
        </li>
        <li class="version">
          <a href="../../across/2.1.3/index.html">2.1.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Application Guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../guides/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../guides/5.1.0-SNAPSHOT/index.html">5.1.0-SNAPSHOT</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Auto-configuration Support</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../across-autoconfigure/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../across-autoconfigure/3.0.0-SNAPSHOT/index.html">3.0.0-SNAPSHOT</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Migration guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../migration/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../migration/5.1.0-SNAPSHOT/index.html">5.1.0-SNAPSHOT</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Admin Web</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../admin-web-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../admin-web-module/4.1.0-SNAPSHOT/index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../admin-web-module/3.2.0/index.html">3.2.0</a>
        </li>
        <li class="version">
          <a href="../../admin-web-module/3.1.1/index.html">3.1.1</a>
        </li>
        <li class="version">
          <a href="../../admin-web-module/3.1.0/index.html">3.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Application Info</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../application-info-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../application-info-module/2.1.0-SNAPSHOT/index.html">2.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../application-info-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Batch Processing</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spring-batch-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../spring-batch-module/2.1.0-SNAPSHOT/index.html">2.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../spring-batch-module/1.0.2/index.html">1.0.2</a>
        </li>
        <li class="version">
          <a href="../../spring-batch-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Bootstrap UI</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../bootstrap-ui-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../bootstrap-ui-module/3.1.0-SNAPSHOT/index.html">3.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../bootstrap-ui-module/2.2.2/index.html">2.2.2</a>
        </li>
        <li class="version">
          <a href="../../bootstrap-ui-module/2.2.1/index.html">2.2.1</a>
        </li>
        <li class="version">
          <a href="../../bootstrap-ui-module/2.1.1/index.html">2.1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Caching - Ehcache</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ehcache-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../ehcache-module/2.1.0-SNAPSHOT/index.html">2.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../ehcache-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Debug Web</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../debug-web-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../debug-web-module/3.1.0-SNAPSHOT/index.html">3.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../debug-web-module/2.0.0/index.html">2.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Documents & Forms</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../dynamic-forms-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../dynamic-forms-module/0.2.0-SNAPSHOT/index.html">0.2.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../dynamic-forms-module/0.0.3/index.html">0.0.3</a>
        </li>
        <li class="version">
          <a href="../../dynamic-forms-module/0.0.2/index.html">0.0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Entity Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../entity-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../entity-module/4.1.0-SNAPSHOT/index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../entity-module/3.4.0/index.html">3.4.0</a>
        </li>
        <li class="version">
          <a href="../../entity-module/3.3.0/index.html">3.3.0</a>
        </li>
        <li class="version">
          <a href="../../entity-module/3.2.0/index.html">3.2.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: File Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../file-manager-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../file-manager-module/2.2.0-SNAPSHOT/index.html">2.2.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../file-manager-module/2.1.0-SNAPSHOT/index.html">2.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../file-manager-module/1.4.0/index.html">1.4.0</a>
        </li>
        <li class="version">
          <a href="../../file-manager-module/1.3.0/index.html">1.3.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Module: Hibernate JPA</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../index.html">master</a>
        </li>
        <li class="version is-current">
          <a href="index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../3.0.0/index.html">3.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: LDAP Support</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ldap-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../ldap-module/2.1.0-SNAPSHOT/index.html">2.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../ldap-module/1.0.1/index.html">1.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Logging</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../logging-module/3.1.0-SNAPSHOT/index.html">3.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../logging-module/1.1.0/index.html">1.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Mobile Support</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spring-mobile-module/3.1.0-SNAPSHOT/index.html">3.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../spring-mobile-module/2.0.0/index.html">2.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Properties</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../properties-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../properties-module/2.1.0-SNAPSHOT/index.html">2.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../properties-module/1.1.1/index.html">1.1.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spring-security-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../spring-security-module/4.1.0-SNAPSHOT/index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../spring-security-module/3.0.2/index.html">3.0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security - ACLs</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spring-security-acl-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../spring-security-acl-module/4.1.0-SNAPSHOT/index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../spring-security-acl-module/3.0.2/index.html">3.0.2</a>
        </li>
        <li class="version">
          <a href="../../spring-security-acl-module/3.0.1/index.html">3.0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Security - OAuth2</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../oauth2-module/3.1.0-SNAPSHOT/index.html">3.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../oauth2-module/2.1.1/index.html">2.1.1</a>
        </li>
        <li class="version">
          <a href="../../oauth2-module/2.1.0/index.html">2.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: User Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../user-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../user-module/4.1.0-SNAPSHOT/index.html">4.1.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../user-module/3.1.1/index.html">3.1.1</a>
        </li>
        <li class="version">
          <a href="../../user-module/3.1.0/index.html">3.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Module: Web CMS</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../web-cms-module/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../web-cms-module/0.2.0-SNAPSHOT/index.html">0.2.0-SNAPSHOT</a>
        </li>
        <li class="version">
          <a href="../../web-cms-module/0.0.7/index.html">0.0.7</a>
        </li>
        <li class="version">
          <a href="../../web-cms-module/0.0.6/index.html">0.0.6</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
    <script>
      var indexName = window.location.href.indexOf('across-site/production/')>0 ? 'antora-across-site-production' : 'antora-across-site-preview';
      docsearch({
                  appId: 'YNK2RERBV5',
                  apiKey: '201d66bbf44a6c62002472e491d74568',
                  indexName: indexName,
                  inputSelector: '#search-input',
                  algoliaOptions: { hitsPerPage: 10 }
                })
    </script>
  </aside>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../across/index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Module: Hibernate JPA</a></li>
    <li class="crumb"><a href="multiple-entity-managers.html">Multiple entity managers</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="versions-menu-toggle" title="Show other versions of page">4.1.0-SNAPSHOT</button>
  <div class="versions-menu">
    <a class="version" href="../multiple-entity-managers.html">master</a>
    <a class="version is-current" href="multiple-entity-managers.html">4.1.0-SNAPSHOT</a>
    <a class="version" href="../3.0.0/multiple-entity-managers.html">3.0.0</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/ForeachOS/ax-docs-hibernate-jpa-module/edit/develop-5.0.0/docs/modules/ROOT/pages/multiple-entity-managers.adoc">Edit this Page</a></div>
</div>
<article class="doc"><a name="section-top"></a>
      <h1>Multiple EntityManagers</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A single AcrossHibernateJpaModule represents a single <code>EntityManager</code> attached to a single datasource.
If you require multiple <code>EntityManager</code> instances you can use AcrossHibernateJpeModule as a base for a new module.</p>
</div>
<div class="paragraph">
<p>A couple of things noteworthy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>every instance creates its own <code>EntityManager</code> and builds its own mapping context</p>
<div class="ulist">
<ul>
<li>
<p>modules will need to specify separately which entities they want to register in which mapping context</p>
</li>
</ul>
</div>
</li>
<li>
<p>every instance has its own set of <a href="#module-settings">settings</a> used for configuration</p>
</li>
<li>
<p>every instance exposes at least its own <code>EntityManagerFactory</code>, <code>PlatformTransactionManager</code> and <code>TransactionTemplate</code></p>
<div class="ulist">
<ul>
<li>
<p>you should ensure that one of each is preferably marked as primary, see property <code>acrossHibernate.primary</code></p>
</li>
<li>
<p>you should ensure all of them are exposed under a unique name to avoid conflicts (eg. by prefixing them using an <code>ExposedBeanDefinitionTransformer</code>)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>An application usually has to take special care when working in a configuration with multiple JPA modules.
Usually the default AcrossHibernateJpaModule will be set as primary and additional modules only used explicitly.</p>
</div>
<div class="paragraph">
<p>There are 2 ways to create additional JPA modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create a custom module at runtime</p>
</li>
<li>
<p>extend AcrossHibernateJpaModule to create a separate shared module</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_runtime_jpa_module"><a class="anchor" href="#_runtime_jpa_module"></a>Runtime JPA module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Creating a separate JPA module at runtime is very convenient, especially when only required in a single application.
You can easily create a custom module using the <code>AcrossHibernateJpaModule.builder()</code>.</p>
</div>
<div class="paragraph">
<p>As a minimum you should specify a unique prefix for that module, which will be used to generate the rest of the configuration options.</p>
</div>
<div class="listingblock">
<div class="title">Example runtime JPA module and datasource</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Bean
@ConfigurationProperties("app.datasource.my")
public DataSourceProperties myDataSourceProperties() {
    return new DataSourceProperties();
}

@Bean
@ConfigurationProperties("app.datasource.my")
public DataSource myDataSource() {
    return myDataSourceProperties().initializeDataSourceBuilder().build();
}

@Bean
public AcrossHibernateJpaModule myJpaModule() {
    return AcrossHibernateJpaModule.builder().prefix( "my" ).build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example defines a separate datasource which reads the properties <code>app.datasource.my</code> and creates the <code>DataSource</code> bean called <code>myDataSource</code>.</p>
</div>
<div class="paragraph">
<p>The custom <code>AcrossHibernateJpaModule</code> is built using only the prefix <strong>my</strong>, which results in the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the generated module name will be <code>MyJpaModule</code></p>
</li>
<li>
<p>all properties starting with <code>my.jpa</code> will be considered configuration properties for that module (eg. <code>my.jpa.generate-ddl=true</code>)</p>
</li>
<li>
<p>a datasource bean named <strong>myDataSource</strong> will be expected as the datasource for the mapping context</p>
</li>
<li>
<p>exposed beans will be prefixed with <code>my</code>, resulting in <code>PlatformTransactionManager</code> being exposed as <strong>myJpaTransactionManager</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>AcrossHibernateJpaModuleBuilder</code> allows customizing all options of your module separately.
See the javadoc or source code for all details.</p>
</div>
<div class="paragraph">
<p>Entities should be attached explicitly to the separate mapping context:</p>
</div>
<div class="listingblock">
<div class="title">Registering entities for the runtime JPA module</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ModuleConfiguration("MyJpaModule")
@EntityScan(basePackageClasses = MyEntity.class)
public class MyEntitiesRegistrar
{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Likewise, using Spring Data JPA repositories requires you to configure them manually with the correct <code>PlatformTransactionManager</code> and <code>EntityManagerFactory</code> reference.</p>
</div>
<div class="listingblock">
<div class="title">Enabling the Spring Data JPA repositories in your module</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@EnableAcrossJpaRepositories(
  transactionManagerRef = "myJpaTransactionManager",
  entityManagerFactoryRef = "myEntityManagerFactory"
)
public class MyEntitiesConfiguration
{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This way, it would be perfectly possible for <code>MyJpaModule</code> to be present alongside any number of other <code>AcrossHibernateJpaModule</code> instances.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_shared_jpa_module"><a class="anchor" href="#_shared_jpa_module"></a>Shared JPA module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to create a new shared module building a different <code>EntityManager</code>, you can extend <code>AcrossHibernateJpaModule</code> and customize some settings.</p>
</div>
<div class="listingblock">
<div class="title">Custom shared module</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CustomConnectorModule extends AcrossHibernateJpaModule
{
	public static final String NAME = "CustomConnectorModule";

	public CustomConnectorModule() {
		setPropertiesPrefix( "customConnector" ); <i class="conum" data-value="1"></i><b>(1)</b>
		setExposeTransformer( new BeanPrefixingTransformer( "custom" ) ); <i class="conum" data-value="2"></i><b>(2)</b>
		setPrimary( true ); <i class="conum" data-value="3"></i><b>(3)</b>
	}

	@Override
	public String getName() {
		return NAME; <i class="conum" data-value="4"></i><b>(4)</b>
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure a separate properties prefix.
All properties starting with <code>customConnector</code> will be considered configuration properties for this module (eg. <code>customConnector.generate-ddl=true</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Unique prefix to be added to the exposed beans.
In this case the <code>PlatformTransactionManager</code> will be exposed as <strong>customJpaTransactionManager</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Explicitly set this module primary.
Do this only in the case where you want this module to always expose the primary transaction manager.
When combining with AcrossHibernateJpaModule in the same application, it is also important to unset the default module primary status.
You can always omit this and set the primary status using the corresponding property value instead.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>As with any custom Across module, provide it a unique name.
Providing the <code>public static final String NAME</code> allows the module to be scanned by name.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you easily want to generate Spring Boot configuration metadata for your custom properties, you could additionally extend <code>AcrossHibernateJpaModuleSettings</code> and register a seperate <code>@ConfigurationProperties</code>.</p>
</div>
<div class="listingblock">
<div class="title">Build Spring Boot configuration metadata for the <strong>customConnector</strong> properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigurationProperties("customConnector")
public class CustomConnectorModuleSettings extends AcrossHibernateJpaModuleSettings
{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Registering entities or activating Spring Data JPA repositories is done in exactly the same way as with a separate runtime JPA module.</p>
</div>
<div class="paragraph">
<p>Using a fully custom shared module also allows you to add additional configuration to your module.</p>
</div>
</div>
</div>
    <div class="article-footer-nav">
        <a class="article-footer-nav-previous" href="entity-intercepting.html">&laquo; Entity intercepting</a>
            <span class="article-footer-nav-current">Multiple entity managers</span>
        <a class="article-footer-nav-next" href="helpers.html">Helper classes and utilities &raquo;</a>
    </div>
</article>
<aside class="article-aside hidden" role="navigation">
  <h3 class="toc-title">Contents</h3>
  <div id="article-toc"></div>
</aside>
  </main>
</div>
<footer class="footer">
  <p>The Across documentation site is generated using <a href="https://antora.org" target="_blank">Antora</a>.</p>
  <div class="footer-totop">
    <!--srcset="/acrossWebsite/img/foreach-logo@2x.png 2x"-->
    <a class="footer-partner" href="http://foreach.be/" target="_blank">
      sponsored by <svg width="20" height="20" viewBox="0 0 277 311" xmlns="http://www.w3.org/2000/svg">
        <g fill="none" fill-rule="evenodd">
          <path d="M27 307.3V133.5H.9V92.7H27v-8.8c0-24.1 4.3-46.5 19.7-64.1C58.2 6.6 74.7.1 92.9.1c13.4 0 23.7 2.2 31.2 4.8l-5.9 44.8c-3.9-1.8-9.5-2.6-15.8-2.6-17.4 0-23.7 16.7-23.7 35.5v10.1h33.6v40.8H78.7v173.8H27z" fill="#FFCE01" fill-rule="nonzero"></path>
          <path d="M229.2 181c0-27.6-6.3-49.1-21.7-49.1-17 0-23.7 27.7-24.1 49.1h45.8zM183 221.4c.8 33.4 18.2 45.6 41.1 45.6 14.6 0 27.6-3.5 36.7-7l7.1 41.2c-13.4 5.7-33.6 9.7-53.3 9.7-52.5 0-81.4-38.6-81.4-105.8 0-72 33.6-115 77.4-115 41.5 0 65.6 36.4 65.6 101.4 0 15.4-.4 23.7-1.6 29.8H183v.1z" fill="#FFF" fill-rule="nonzero"></path>
        </g>
      </svg>
    </a>
    <a href="#section-top">
      <svg width="34" height="34" viewBox="0 0 62 62" xmlns="http://www.w3.org/2000/svg">
        <title>icon</title>
        <g transform="rotate(-90 30.5 30.5)" fill="none" fill-rule="evenodd">
          <circle stroke="#ffffff" fill="#1D2A3A" transform="rotate(180 30.007 30.942)" cx="30.007" cy="30.942" r="30"></circle>
          <path fill="#ffffff" d="M25 38.884h3.713l6.3-7.797-6.3-8.087-3.713.064 6.155 7.972"></path>
        </g>
      </svg>
    </a>
  </div>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script>
  tocbot.init( {
                 tocSelector: '#article-toc',
                 contentSelector: 'article',
                 headingSelector: 'h2, h3, h4',
                 collapseDepth: 3,
                 positionFixedSelector: '#article-toc',
                 scrollSmooth: false
               } );
  var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
  if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
    document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
  }
</script>
  </body>
</html>
